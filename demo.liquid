{{ 'section-contact-form.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}

<div class="color-{{ section.settings.color_scheme }} gradient">
  <div class="contact page-width page-width--narrow section-{{ section.id }}-padding">
{%- form 'contact', id: 'ContactForm', class: contact_form_class -%}
  {%- if form.posted_successfully? -%}
    <h2 class="form-status form-status-list form__message" tabindex="-1" autofocus>
      {{- 'icon-success.svg' | inline_asset_content -}}
      {{ 'templates.contact.form.post_success' | t }}
    </h2>
  {%- elsif form.errors -%}
    <div class="form__message">
      <h2 class="form-status caption-large text-body" role="alert" tabindex="-1" autofocus>
        {{- 'icon-error.svg' | inline_asset_content -}}
        {{ 'templates.contact.form.error_heading' | t }}
      </h2>
    </div>
    <ul class="form-status-list caption-large" role="list">
      {%- if form.errors contains 'email' -%}
        <li>
          <a href="#ContactForm-email" class="link">
            {{ form.errors.translated_fields.email | capitalize }}
            {{ form.errors.messages.email }}
          </a>
        </li>
      {%- endif -%}
    </ul>
  {%- endif -%}

  <!-- DEFAULT NAME + EMAIL ROW -->
  <div class="contact__fields">
    <div class="field">
      <input
        class="field__input"
        autocomplete="name"
        type="text"
        id="ContactForm-name"
        name="contact[name]"
        value="{% if form.name %}{{ form.name }}{% elsif customer %}{{ customer.name }}{% endif %}"
        placeholder="{{ 'templates.contact.form.name' | t }}"
      >
      <label class="field__label" for="ContactForm-name">{{ 'templates.contact.form.name' | t }}</label>
    </div>

    <div class="field field--with-error">
      <input
        autocomplete="email"
        type="email"
        id="ContactForm-email"
        class="field__input"
        name="contact[email]"
        spellcheck="false"
        autocapitalize="off"
        value="{% if form.email %}{{ form.email }}{% elsif customer %}{{ customer.email }}{% endif %}"
        aria-required="true"
        {% if form.errors contains 'email' %}
          aria-invalid="true"
          aria-describedby="ContactForm-email-error"
        {% endif %}
        placeholder="{{ 'templates.contact.form.email' | t }}"
        required
      >
      <label class="field__label" for="ContactForm-email">
        {{- 'templates.contact.form.email' | t }}
        <span aria-hidden="true">*</span>
      </label>
      {%- if form.errors contains 'email' -%}
        <small class="contact__field-error" id="ContactForm-email-error">
          <span class="visually-hidden">{{ 'accessibility.error' | t }}</span>
          <span class="form__message">
            <span class="svg-wrapper">
              {{- 'icon-error.svg' | inline_asset_content -}}
            </span>
            {{- form.errors.translated_fields.email | capitalize }}
            {{ form.errors.messages.email -}}
          </span>
        </small>
      {%- endif -%}
    </div>
  </div>

  <!-- PHONE -->
  <div class="field">
    <input
      type="tel"
      id="ContactForm-phone"
      class="field__input"
      autocomplete="tel"
      name="contact[phone]"
      pattern="[0-9\-+ ]*"
      value="{% if form.phone %}{{ form.phone }}{% elsif customer %}{{ customer.phone }}{% endif %}"
      placeholder="{{ 'templates.contact.form.phone' | t }}"
    >
    <label class="field__label" for="ContactForm-phone">{{ 'templates.contact.form.phone' | t }}</label>
  </div>

  <!-- DATE -->
  <div class="field">
    <label class="field__label" for="ContactForm-date">Date</label>
    <input
      type="date"
      id="ContactForm-date"
      class="field__input"
      name="contact[Date]"
    >
  </div>

  <!-- COMPANY -->
  <div class="field">
    <label class="field__label" for="ContactForm-company">Company Name *</label>
    <input
      type="text"
      id="ContactForm-company"
      class="field__input"
      name="contact[Company Name]"
      required
    >
  </div>

  <!-- ADDRESS 1 + 2 -->
  <div class="field">
    <label class="field__label" for="ContactForm-address1">Address Line 1</label>
    <input
      type="text"
      id="ContactForm-address1"
      class="field__input"
      name="contact[Address Line 1]"
    >
  </div>

  <div class="field">
    <label class="field__label" for="ContactForm-address2">Address Line 2</label>
    <input
      type="text"
      id="ContactForm-address2"
      class="field__input"
      name="contact[Address Line 2]"
    >
  </div>

  <!-- COUNTRY + STATE ROW -->
  <div class="contact__fields">
    <div class="field">
      <label class="field__label" for="countrySelect">Country</label>
      <select
        class="field__input"
        id="countrySelect"
        name="contact[Country]"
      >
        <option value="">Select country</option>
      </select>
    </div>

    <div class="field">
      <label class="field__label" for="stateSelect">State / Province</label>
      <select
        class="field__input"
        id="stateSelect"
        name="contact[State]"
      >
        <option value="">Select country first</option>
      </select>
    </div>
  </div>

  <!-- CITY + POSTAL -->
  <div class="contact__fields">
    <div class="field">
      <label class="field__label" for="ContactForm-city">City</label>
      <input
        type="text"
        id="ContactForm-city"
        class="field__input"
        name="contact[City]"
      >
    </div>

    <div class="field">
      <label class="field__label" for="ContactForm-postal">Postal / Zip Code</label>
      <input
        type="text"
        id="ContactForm-postal"
        class="field__input"
        name="contact[Postal Code]"
      >
    </div>
  </div>

  <!-- MANUFACTURING FACILITY -->
  <div class="field">
    <label class="field__label" for="ContactForm-facility">
      Do you have an existing manufacturing facility?
    </label>
    <select
      id="ContactForm-facility"
      class="field__input"
      name="contact[Manufacturing Facility]"
    >
      <option value="">Select</option>
      <option value="Yes">Yes</option>
      <option value="No">No</option>
    </select>
  </div>

  <!-- REQUIREMENT SUMMARY -->
  <div class="field">
    <label class="field__label" for="ContactForm-summary">Requirement Summary</label>
    <textarea
      rows="4"
      id="ContactForm-summary"
      class="text-area field__input"
      name="contact[Requirement Summary]"
    ></textarea>
  </div>

  <!-- ✅ PREFORM & CAPS – MULTI-SELECT CHECKBOXES -->
<div class="field">
  <span class="field__label">Preform & Caps – Sizes</span>

  <div id="sizeButtons">
    <button type="button" data-size="200ml">200ml</button>
    <button type="button" data-size="250ml">250ml</button>
    <button type="button" data-size="300ml">300ml</button>
    <button type="button" data-size="500ml">500ml</button>
    <button type="button" data-size="750ml">750ml</button>
    <button type="button" data-size="1000ml">1000ml</button>
    <button type="button" data-size="Not applicable">Not applicable</button>
  </div>

  <input type="hidden" name="contact[Sizes]" id="sizesHidden">
</div>


  <!-- PURCHASE TIMEFRAME -->
  <div class="field">
    <label class="field__label" for="ContactForm-timeframe">Expected Purchase Timeframe</label>
    <input
      type="text"
      id="ContactForm-timeframe"
      class="field__input"
      name="contact[Purchase Timeframe]"
    >
  </div>

  <!-- MOQ -->
  <div class="field">
    <label class="field__label" for="ContactForm-moq">MOQ</label>
    <input
      type="text"
      id="ContactForm-moq"
      class="field__input"
      name="contact[MOQ]"
    >
  </div>

  <!-- OPTIONAL GENERAL MESSAGE -->
  <div class="field">
    <textarea
      rows="6"
      id="ContactForm-body"
      class="text-area field__input"
      name="contact[body]"
      placeholder="{{ 'templates.contact.form.comment' | t }}"
    >{{- form.body -}}</textarea>
    <label class="form__label field__label" for="ContactForm-body">
      {{- 'templates.contact.form.comment' | t -}}
    </label>
  </div>

  <!-- SUBMIT BUTTON -->
  <div class="contact__button">
    <button type="submit" class="button">
      {{ 'templates.contact.form.send' | t }}
    </button>
  </div>

{%- endform -%}

<!-- COUNTRY/STATE SCRIPT -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const hidden = document.getElementById("sizesHidden");
  const buttons = document.querySelectorAll("#sizeButtons button");
  let values = [];

  buttons.forEach(btn => {
    btn.addEventListener("click", () => {

      const val = btn.dataset.size;

      if (values.includes(val)) {
        // remove value
        values = values.filter(v => v !== val);
        btn.classList.remove("selected");
      } else {
        // add value
        values.push(val);
        btn.classList.add("selected");
      }

      hidden.value = values.join(", ");
    });
  });
});
</script>


<script>
document.addEventListener("DOMContentLoaded", function () {
  const countrySelect = document.getElementById("countrySelect");
  const stateSelect = document.getElementById("stateSelect");

  fetch("https://countriesnow.space/api/v0.1/countries/states")
    .then(res => res.json())
    .then(data => {
      const countries = data.data;

      // Populate countries
      countries.forEach(c => {
        let opt = document.createElement("option");
        opt.value = c.name;
        opt.textContent = c.name;
        countrySelect.appendChild(opt);
      });

      // On country change → load states
      countrySelect.addEventListener("change", function () {
        stateSelect.innerHTML = "";

        const selectedCountry = countries.find(
          c => c.name === countrySelect.value
        );

        if (selectedCountry && selectedCountry.states.length > 0) {
          selectedCountry.states.forEach(s => {
            let opt = document.createElement("option");
            opt.value = s.name;
            opt.textContent = s.name;
            stateSelect.appendChild(opt);
          });
        } else {
          let opt = document.createElement("option");
          opt.textContent = "No states available";
          stateSelect.appendChild(opt);
        }
      });
    });
});
</script>


  </div>
</div>


{% schema %}
{
  "name": "t:sections.contact-form.name",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "inline_richtext",
      "id": "heading",
      "default": "t:sections.contact-form.settings.title.default",
      "label": "t:sections.contact-form.settings.title.label"
    },
    {
      "type": "select",
      "id": "heading_size",
      "options": [
        {
          "value": "h2",
          "label": "t:sections.all.heading_size.options__1.label"
        },
        {
          "value": "h1",
          "label": "t:sections.all.heading_size.options__2.label"
        },
        {
          "value": "h0",
          "label": "t:sections.all.heading_size.options__3.label"
        },
        {
          "value": "hxl",
          "label": "t:sections.all.heading_size.options__4.label"
        },
        {
          "value": "hxxl",
          "label": "t:sections.all.heading_size.options__5.label"
        }
      ],
      "default": "h1",
      "label": "t:sections.all.heading_size.label"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "t:sections.all.padding.section_padding_heading"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 36
    }
  ],
  "presets": [
    {
      "name": "t:sections.contact-form.presets.name"
    }
  ]
}
{% endschema %}
